import pandas as pd
import yfinance as yf
from datetime import datetime, timedelta
import time

# Define the Nifty 500 stocks manually (top 50 as example)
# You can add more symbols to this list
NIFTY_STOCKS = [

'20MICRONS',
'21STCENMGM',
'360ONE',
'3IINFOLTD',
'3MINDIA',
'3PLAND',
'5PAISA',
'63MOONS',
'A2ZINFRA',
'AAATECH',
'AADHARHFC',
'AAKASH',
'AAREYDRUGS',
'AARON',
'AARTECH',
'AARTIDRUGS',
'AARTIIND',
'AARTIPHARM',
'AARTISURF',
'AARVEEDEN',
'AARVI',
'AAVAS',
'ABAN',
'ABB',
'ABBOTINDIA',
'ABCAPITAL',
'ABCOTS',
'ABDL',
'ABFRL',
'ABINFRA',
'ABLBL',
'ABMINTLLTD',
'ABREL',
'ABSLAMC',
'ACC',
'ACCELYA',
'ACCURACY',
'ACE',
'ACEINTEG',
'ACI',
'ACL',
'ACLGATI',
'ACMESOLAR',
'ACUTAAS',
'ADANIENSOL',
'ADANIENT',
'ADANIGREEN',
'ADANIPORTS',
'ADANIPOWER',
'ADFFOODS',
'ADL',
'ADOR',
'ADROITINFO',
'ADSL',
'ADVANIHOTR',
'ADVENZYMES',
'AEGISLOG',
'AEGISVOPAK',
'AEROENTER',
'AEROFLEX',
'AERONEU',
'AETHER',
'AFCONS',
'AFFLE',
'AFFORDABLE',
'AFIL',
'AFSL',
'AGARIND',
'AGARWALEYE',
'AGI',
'AGIIL',
'AGRITECH',
'AGROPHOS',
'AGSTRA',
'AHCL',
'AHLADA',
'AHLEAST',
'AHLUCONT',
'AIAENG',
'AIIL',
'AIRAN',
'AIROLAM',
'AJANTPHARM',
'AJAXENGG',
'AJMERA',
'AJOONI',
'AKASH',
'AKG',
'AKI',
'AKSHAR',
'AKSHARCHEM',
'AKSHOPTFBR',
'AKUMS',
'AKZOINDIA',
'ALANKIT',
'ALBERTDAVD',
'ALEMBICLTD',
'ALICON',
'ALIVUS',
'ALKALI',
'ALKEM',
'ALKYLAMINE',
'ALLCARGO',
'ALLDIGI',
'ALLTIME',
'ALMONDZ',
'ALOKINDS',
'ALPA',
'ALPHAGEO',
'ALPSINDUS',
'AMANTA',
'AMBER',
'AMBICAAGAR',
'AMBIKCO',
'AMBUJACEM',
'AMDIND',
'AMJLAND',
'AMNPLST',
'AMRUTANJAN',
'ANANDRATHI',
'ANANTRAJ',
'ANDHRAPAP',
'ANDHRSUGAR',
'ANGELONE',
'ANIKINDS',
'ANKITMETAL',
'ANMOL',
'ANSALAPI',
'ANTELOPUS',
'ANTGRAPHIC',
'ANTHEM',
'ANUHPHR',
'ANUP',
'ANURAS',
'APARINDS',
'APCL',
'APCOTEXIND',
'APEX',
'APLAPOLLO',
'APLLTD',
'APOLLO',
'APOLLOHOSP',
'APOLLOPIPE',
'APOLLOTYRE',
'APOLSINHOT',
'APTECHT',
'APTUS',
'ARCHIDPLY',
'ARCHIES',
'ARE&M',
'ARENTERP',
'ARFIN',
'ARIES',
'ARIHANTCAP',
'ARIHANTSUP',
'ARISINFRA',
'ARKADE',
'ARMANFIN',
'AROGRANITE',
'ARROWGREEN',
'ARSHIYA',
'ARSSBL',
'ARTEMISMED',
'ARTNIRMAN',
'ARVEE',
'ARVIND',
'ARVINDFASN',
'ARVSMART',
'ASAHIINDIA',
'ASAHISONG',
'ASAL',
'ASALCBR',
'ASHAPURMIN',
'ASHIANA',
'ASHIMASYN',
'ASHOKA',
'ASHOKAMET',
'ASHOKLEY',
'ASIANENE',
'ASIANHOTNR',
'ASIANPAINT',
'ASIANTILES',
'ASKAUTOLTD',
'ASMS',
'ASPINWALL',
'ASTEC',
'ASTERDM',
'ASTRAL',
'ASTRAMICRO',
'ASTRAZEN',
'ASTRON',
'ATALREAL',
'ATAM',
'ATGL',
'ATHERENERG',
'ATL',
'ATLANTAA',
'ATLANTAELE',
'ATLASCYCLE',
'ATUL',
'ATULAUTO',
'AUBANK',
'AURIONPRO',
'AUROPHARMA',
'AURUM',
'AUSOMENT',
'AUTOAXLES',
'AUTOIND',
'AVADHSUGAR',
'AVALON',
'AVANTEL',
'AVANTIFEED',
'AVG',
'AVL',
'AVONMORE',
'AVROIND',
'AVTNPL',
'AWFIS',
'AWHCL',
'AWL',
'AXISBANK',
'AXISCADES',
'AXITA',
'AYMSYNTEX',
'AZAD',
'BAFNAPH',
'BAGFILMS',
'BAIDFIN',
'BAJAJ-AUTO',
'BAJAJCON',
'BAJAJELEC',
'BAJAJFINSV',
'BAJAJHCARE',
'BAJAJHFL',
'BAJAJHIND',
'BAJAJHLDNG',
'BAJAJINDEF',
'BAJEL',
'BAJFINANCE',
'BALAJEE',
'BALAJITELE',
'BALAMINES',
'BALAXI',
'BALKRISHNA',
'BALKRISIND',
'BALMLAWRIE',
'BALPHARMA',
'BALRAMCHIN',
'BALUFORGE',
'BANARBEADS',
'BANARISUG',
'BANCOINDIA',
'BANDHANBNK',
'BANG',
'BANKA',
'BANKBARODA',
'BANKINDIA',
'BANSALWIRE',
'BANSWRAS',
'BARBEQUE',
'BASF',
'BASML',
'BATAINDIA',
'BAYERCROP',
'BBL',
'BBOX',
'BBTC',
'BBTCL',
'BCG',
'BCLIND',
'BCONCEPTS',
'BDL',
'BEARDSELL',
'BECTORFOOD',
'BEDMUTHA',
'BEL',
'BELLACASA',
'BELRISE',
'BEML',
'BEPL',
'BERGEPAINT',
'BESTAGRO',
'BFINVEST',
'BFUTILITIE',
'BGRENERGY',
'BHAGCHEM',
'BHAGERIA',
'BHAGYANGR',
'BHANDARI',
'BHARATFORG',
'BHARATGEAR',
'BHARATRAS',
'BHARATSE',
'BHARATWIRE',
'BHARTIARTL',
'BHARTIHEXA',
'BHEL',
'BIGBLOC',
'BIKAJI',
'BIL',
'BILVYAPAR',
'BIOCON',
'BIOFILCHEM',
'BIRLACABLE',
'BIRLACORPN',
'BIRLAMONEY',
'BIRLANU',
'BLACKBUCK',
'BLAL',
'BLBLIMITED',
'BLISSGVS',
'BLKASHYAP',
'BLS',
'BLSE',
'BLUECOAST',
'BLUEDART',
'BLUEJET',
'BLUESTARCO',
'BLUESTONE',
'BLUSPRING',
'BMWVENTLTD',
'BODALCHEM',
'BOHRAIND',
'BOMDYEING',
'BORANA',
'BOROLTD',
'BORORENEW',
'BOROSCI',
'BOSCHLTD',
'BPCL',
'BPL',
'BRIGADE',
'BRIGHOTEL',
'BRITANNIA',
'BRNL',
'BROOKS',
'BSE',
'BSHSL',
'BSL',
'BSOFT',
'BTML',
'BUTTERFLY',
'BVCL',
'BYKE',
'CALSOFT',
'CAMLINFINE',
'CAMPUS',
'CAMS',
'CANBK',
'CANFINHOME',
'CANTABIL',
'CAPACITE',
'CAPITALSFB',
'CAPLIPOINT',
'CAPTRUST',
'CARBORUNIV',
'CARERATING',
'CARRARO',
'CARTRADE',
'CARYSIL',
'CASTROLIND',
'CCCL',
'CCHHL',
'CCL',
'CDSL',
'CEATLTD',
'CEIGALL',
'CELEBRITY',
'CELLO',
'CEMPRO',
'CENTENKA',
'CENTEXT',
'CENTRALBK',
'CENTRUM',
'CENTUM',
'CENTURYPLY',
'CERA',
'CEREBRAINT',
'CESC',
'CEWATER',
'CGCL',
'CGPOWER',
'CHALET',
'CHAMBLFERT',
'CHEMBOND',
'CHEMBONDCH',
'CHEMCON',
'CHEMFAB',
'CHEMPLASTS',
'CHENNPETRO',
'CHEVIOT',
'CHOICEIN',
'CHOLAFIN',
'CHOLAHLDNG',
'CIEINDIA',
'CIFL',
'CIGNITITEC',
'CINELINE',
'CINEVISTA',
'CIPLA',
'CLEAN',
'CLEDUCATE',
'CLSEL',
'CMSINFO',
'COALINDIA',
'COASTCORP',
'COCHINSHIP',
'COFFEEDAY',
'COFORGE',
'COHANCE',
'COLPAL',
'COMPINFO',
'COMPUSOFT',
'COMSYN',
'CONCOR',
'CONCORDBIO',
'CONFIPET',
'CONSOFINVT',
'CONTROLPR',
'CORALFINAC',
'CORDSCABLE',
'COROMANDEL',
'COSMOFIRST',
'COUNCODOS',
'CPCAP',
'CPEDU',
'CPPLUS',
'CRAFTSMAN',
'CREATIVE',
'CREATIVEYE',
'CREDITACC',
'CREST',
'CRISIL',
'CRIZAC',
'CROMPTON',
'CROWN',
'CSBBANK',
'CSLFINANCE',
'CTE',
'CUB',
'CUBEXTUB',
'CUMMINSIND',
'CUPID',
'CURAA',
'CYBERMEDIA',
'CYBERTECH',
'CYIENT',
'CYIENTDLM',
'DABUR',
'DALBHARAT',
'DALMIASUG',
'DAMCAPITAL',
'DAMODARIND',
'DANGEE',
'DATAMATICS',
'DATAPATTNS',
'DAVANGERE',
'DBCORP',
'DBEIL',
'DBL',
'DBOL',
'DBREALTY',
'DBSTOCKBRO',
'DCAL',
'DCBBANK',
'DCI',
'DCM',
'DCMFINSERV',
'DCMNVL',
'DCMSHRIRAM',
'DCMSRIND',
'DCW',
'DCXINDIA',
'DDEVPLSTIK',
'DECCANCE',
'DEEDEV',
'DEEPAKFERT',
'DEEPAKNTR',
'DEEPINDS',
'DELHIVERY',
'DELPHIFX',
'DELTACORP',
'DELTAMAGNT',
'DEN',
'DENORA',
'DENTA',
'DEVIT',
'DEVX',
'DEVYANI',
'DGCONTENT',
'DHAMPURSUG',
'DHANBANK',
'DHANI',
'DHANUKA',
'DHARAN',
'DHARMAJ',
'DHRUV',
'DHUNINV',
'DIACABS',
'DIAMINESQ',
'DIAMONDYD',
'DICIND',
'DIFFNKG',
'DIGIDRIVE',
'DIGISPICE',
'DIGITIDE',
'DIGJAMLMTD',
'DIL',
'DISHTV',
'DIVGIITTS',
'DIVISLAB',
'DIXON',
'DJML',
'DLF',
'DLINKINDIA',
'DMART',
'DMCC',
'DNAMEDIA',
'DODLA',
'DOLATALGO',
'DOLLAR',
'DOLPHIN',
'DOMS',
'DONEAR',
'DPABHUSHAN',
'DPSCLTD',
'DPWIRES',
'DRCSYSTEMS',
'DREAMFOLKS',
'DREDGECORP',
'DRREDDY',
'DSSL',
'DTIL',
'DUCON',
'DVL',
'DWARKESH',
'DYCL',
'DYNAMATECH',
'DYNPRO',
'E2E',
'EASEMYTRIP',
'EASTSILK',
'EBGNG',
'ECLERX',
'ECOSMOBLTY',
'EDELWEISS',
'EFCIL',
'EICHERMOT',
'EIDPARRY',
'EIEL',
'EIFFL',
'EIHAHOTELS',
'EIHOTEL',
'EIMCOELECO',
'EKC',
'ELDEHSG',
'ELECON',
'ELECTCAST',
'ELECTHERM',
'ELGIEQUIP',
'ELGIRUBCO',
'ELIN',
'ELLEN',
'EMAMILTD',
'EMAMIPAP',
'EMAMIREAL',
'EMBDL',
'EMCURE',
'EMIL',
'EMKAY',
'EMMBI',
'EMSLIMITED',
'EMUDHRA',
'ENDURANCE',
'ENERGYDEV',
'ENGINERSIN',
'ENIL',
'ENRIN',
'ENTERO',
'EPACK',
'EPACKPEB',
'EPIGRAL',
'EPL',
'EQUIPPP',
'EQUITASBNK',
'ERIS',
'ESABINDIA',
'ESAFSFB',
'ESCORTS',
'ESSARSHPNG',
'ESSENTIA',
'ESTER',
'ETERNAL',
'ETHOSLTD',
'EUREKAFORB',
'EUROBOND',
'EUROPRATIK',
'EUROTEXIND',
'EVEREADY',
'EVERESTIND',
'EXCEL',
'EXCELINDUS',
'EXICOM',
'EXIDEIND',
'EXPLEOSOL',
'EXXARO',
'FACT',
'FAIRCHEMOR',
'FAZE3Q',
'FCL',
'FCSSOFT',
'FDC',
'FEDERALBNK',
'FEDFINA',
'FEL',
'FELDVR',
'FIBERWEB',
'FIEMIND',
'FILATEX',
'FILATFASH',
'FINCABLES',
'FINEORG',
'FINKURVE',
'FINOPB',
'FINPIPE',
'FIRSTCRY',
'FISCHER',
'FIVESTAR',
'FLAIR',
'FLEXITUFF',
'FLFL',
'FLUOROCHEM',
'FMGOETZE',
'FMNL',
'FOCUS',
'FOODSIN',
'FORCEMOT',
'FORTIS',
'FOSECOIND',
'FSC',
'FSL',
'FUSION',
'GABRIEL',
'GAEL',
'GAIL',
'GALAPREC',
'GALAXYSURF',
'GALLANTT',
'GANDHAR',
'GANDHITUBE',
'GANECOS',
'GANESHBE',
'GANESHCP',
'GANESHHOU',
'GANGAFORGE',
'GANGESSECU',
'GARFIBRES',
'GARUDA',
'GATECH',
'GATECHDVR',
'GATEWAY',
'GAYAHWS',
'GCSL',
'GEECEE',
'GEEKAYWIRE',
'GEMAROMA',
'GENCON',
'GENESYS',
'GENUSPAPER',
'GENUSPOWER',
'GEOJITFSL',
'GESHIP',
'GFLLIMITED',
'GHCL',
'GHCLTEXTIL',
'GICHSGFIN',
'GICRE',
'GILLANDERS',
'GILLETTE',
'GINNIFILA',
'GIPCL',
'GKENERGY',
'GKWLIMITED',
'GLAND',
'GLAXO',
'GLENMARK',
'GLFL',
'GLOBAL',
'GLOBALE',
'GLOBALVECT',
'GLOBE',
'GLOBECIVIL',
'GLOBUSSPR',
'GLOSTERLTD',
'GMBREW',
'GMDCLTD',
'GMMPFAUDLR',
'GMRAIRPORT',
'GMRP&UI',
'GNA',
'GNFC',
'GOACARBON',
'GOCLCORP',
'GOCOLORS',
'GODAVARIB',
'GODFRYPHLP',
'GODHA',
'GODIGIT',
'GODREJAGRO',
'GODREJCP',
'GODREJIND',
'GODREJPROP',
'GOENKA',
'GOKEX',
'GOKUL',
'GOKULAGRO',
'GOLDENTOBC',
'GOLDIAM',
'GOLDTECH',
'GOODLUCK',
'GOPAL',
'GOYALALUM',
'GPIL',
'GPPL',
'GPTHEALTH',
'GPTINFRA',
'GRANULES',
'GRAPHITE',
'GRASIM',
'GRAVITA',
'GREAVESCOT',
'GREENLAM',
'GREENPANEL',
'GREENPLY',
'GREENPOWER',
'GRINDWELL',
'GRINFRA',
'GRMOVER',
'GROBTEA',
'GRPLTD',
'GRSE',
'GRWRHITECH',
'GSFC',
'GSLSU',
'GSPL',
'GSS',
'GTECJAINX',
'GTL',
'GTLINFRA',
'GTPL',
'GUFICBIO',
'GUJALKALI',
'GUJAPOLLO',
'GUJGASLTD',
'GUJRAFFIA',
'GUJTHEM',
'GULFOILLUB',
'GULFPETRO',
'GULPOLY',
'GVKPIL',
'GVPIL',
'GVPTECH',
'GVT&D',
'HAL',
'HAPPSTMNDS',
'HAPPYFORGE',
'HARDWYN',
'HARIOMPIPE',
'HARRMALAYA',
'HARSHA',
'HATHWAY',
'HATSUN',
'HAVELLS',
'HAVISHA',
'HBLENGINE',
'HBSL',
'HCC',
'HCG',
'HCL-INSYS',
'HCLTECH',
'HDBFS',
'HDFCAMC',
'HDFCBANK',
'HDFCLIFE',
'HDIL',
'HEADSUP',
'HECPROJECT',
'HEG',
'HEIDELBERG',
'HEMIPROP',
'HERANBA',
'HERCULES',
'HERITGFOOD',
'HEROMOTOCO',
'HESTERBIO',
'HEUBACHIND',
'HEXATRADEX',
'HEXT',
'HFCL',
'HGINFRA',
'HGM',
'HGS',
'HIKAL',
'HILINFRA',
'HILTON',
'HIMATSEIDE',
'HINDALCO',
'HINDCOMPOS',
'HINDCON',
'HINDCOPPER',
'HINDMOTORS',
'HINDOILEXP',
'HINDPETRO',
'HINDUNILVR',
'HINDWAREAP',
'HINDZINC',
'HIRECT',
'HISARMETAL',
'HITECH',
'HITECHCORP',
'HITECHGEAR',
'HLEGLAS',
'HLVLTD',
'HMAAGRO',
'HMT',
'HMVL',
'HNDFDS',
'HOMEFIRST',
'HONASA',
'HONAUT',
'HONDAPOWER',
'HPAL',
'HPIL',
'HPL',
'HSCL',
'HTMEDIA',
'HUBTOWN',
'HUDCO',
'HUHTAMAKI',
'HYBRIDFIN',
'HYUNDAI',
'ICDSLTD',
'ICEMAKE',
'ICICIBANK',
'ICICIGI',
'ICICIPRULI',
'ICIL',
'ICRA',
'IDBI',
'IDEA',
'IDEAFORGE',
'IDFCFIRSTB',
'IEL',
'IEX',
'IFBAGRO',
'IFBIND',
'IFCI',
'IFGLEXPOR',
'IGARASHI',
'IGCL',
'IGIL',
'IGL',
'IGPL',
'IIFL',
'IIFLCAPS',
'IITL',
'IKIO',
'IKS',
'IL&FSENGG',
'IL&FSTRANS',
'IMAGICAA',
'IMFA',
'IMPAL',
'IMPEXFERRO',
'INCREDIBLE',
'INDBANK',
'INDGN',
'INDHOTEL',
'INDIACEM',
'INDIAGLYCO',
'INDIAMART',
'INDIANB',
'INDIANCARD',
'INDIANHUME',
'INDIASHLTR',
'INDIGO',
'INDIGOPNTS',
'INDIQUBE',
'INDNIPPON',
'INDOAMIN',
'INDOBORAX',
'INDOCO',
'INDOFARM',
'INDORAMA',
'INDOSTAR',
'INDOTECH',
'INDOTHAI',
'INDOUS',
'INDOWIND',
'INDRAMEDCO',
'INDSWFTLAB',
'INDTERRAIN',
'INDUSINDBK',
'INDUSTOWER',
'INFIBEAM',
'INFOBEAN',
'INFOMEDIA',
'INFY',
'INGERRAND',
'INNOVACAP',
'INNOVANA',
'INOXGREEN',
'INOXINDIA',
'INOXWIND',
'INSECTICID',
'INSPIRISYS',
'INTELLECT',
'INTENTECH',
'INTERARCH',
'INTLCONV',
'INVENTURE',
'IOB',
'IOC',
'IOLCP',
'IONEXCHANG',
'IPCALAB',
'IPL',
'IRB',
'IRCON',
'IRCTC',
'IREDA',
'IRFC',
'IRIS',
'IRISDOREME',
'IRMENERGY',
'ISFT',
'ISGEC',
'ISHANCH',
'ITC',
'ITCHOTELS',
'ITDC',
'ITI',
'IVALUE',
'IVC',
'IVP',
'IXIGO',
'IZMO',
'J&KBANK',
'JAGRAN',
'JAGSNPHARM',
'JAIBALAJI',
'JAICORPLTD',
'JAINREC',
'JAIPURKURT',
'JAMNAAUTO',
'JARO',
'JASH',
'JAYAGROGN',
'JAYBARMARU',
'JAYNECOIND',
'JAYSREETEA',
'JBCHEPHARM',
'JBMA',
'JCHAC',
'JETFREIGHT',
'JGCHEM',
'JHS',
'JINDALPHOT',
'JINDALPOLY',
'JINDALSAW',
'JINDALSTEL',
'JINDRILL',
'JINDWORLD',
'JIOFIN',
'JISLDVREQS',
'JISLJALEQS',
'JITFINFRA',
'JKCEMENT',
'JKIL',
'JKLAKSHMI',
'JKPAPER',
'JKTYRE',
'JLHL',
'JMA',
'JMFINANCIL',
'JNKINDIA',
'JOCIL',
'JPASSOCIAT',
'JPOLYINVST',
'JPPOWER',
'JSFB',
'JSL',
'JSLL',
'JSWCEMENT',
'JSWENERGY',
'JSWHL',
'JSWINFRA',
'JSWSTEEL',
'JTEKTINDIA',
'JTLIND',
'JUBLCPL',
'JUBLFOOD',
'JUBLINGREA',
'JUBLPHARMA',
'JUNIPER',
'JUSTDIAL',
'JWL',
'JYOTHYLAB',
'JYOTICNC',
'JYOTISTRUC',
'KABRAEXTRU',
'KAJARIACER',
'KAKATCEM',
'KALAMANDIR',
'KALPATARU',
'KALYANI',
'KALYANIFRG',
'KALYANKJIL',
'KAMATHOTEL',
'KAMDHENU',
'KAMOPAINTS',
'KANANIIND',
'KANORICHEM',
'KANPRPLA',
'KANSAINER',
'KAPSTON',
'KARMAENG',
'KARURVYSYA',
'KAUSHALYA',
'KAVDEFENCE',
'KAYA',
'KAYNES',
'KCP',
'KCPSUGIND',
'KDDL',
'KEC',
'KECL',
'KEEPLEARN',
'KEI',
'KELLTONTEC',
'KERNEX',
'KESORAMIND',
'KEYFINSERV',
'KFINTECH',
'KHADIM',
'KHAICHEM',
'KHAITANLTD',
'KHANDSE',
'KICL',
'KILITCH',
'KIMS',
'KINGFA',
'KIOCL',
'KIRIINDUS',
'KIRLOSBROS',
'KIRLOSENG',
'KIRLOSIND',
'KIRLPNU',
'KITEX',
'KKCL',
'KMEW',
'KMSUGAR',
'KNRCON',
'KOHINOOR',
'KOKUYOCMLN',
'KOLTEPATIL',
'KOPRAN',
'KOTAKBANK',
'KOTARISUG',
'KOTHARIPET',
'KOTHARIPRO',
'KPEL',
'KPIGREEN',
'KPIL',
'KPITTECH',
'KPRMILL',
'KRBL',
'KREBSBIO',
'KRIDHANINF',
'KRISHANA',
'KRISHIVAL',
'KRITI',
'KRITIKA',
'KRITINUT',
'KRN',
'KRONOX',
'KROSS',
'KRSNAA',
'KRYSTAL',
'KSB',
'KSCL',
'KSHITIJPOL',
'KSL',
'KSOLVES',
'KTKBANK',
'KUANTUM',
'LAGNAM',
'LAKPRE',
'LAL',
'LALPATHLAB',
'LAMBODHARA',
'LANCORHOL',
'LANDMARK',
'LAOPALA',
'LASA',
'LATENTVIEW',
'LATTEYS',
'LAURUSLABS',
'LAXMICOT',
'LAXMIDENTL',
'LAXMIINDIA',
'LCCINFOTEC',
'LEMONTREE',
'LEXUS',
'LFIC',
'LGBBROSLTD',
'LGHL',
'LIBAS',
'LIBERTSHOE',
'LICHSGFIN',
'LICI',
'LIKHITHA',
'LINC',
'LINCOLN',
'LINDEINDIA',
'LLOYDSENGG',
'LLOYDSENT',
'LLOYDSME',
'LMW',
'LODHA',
'LOKESHMACH',
'LORDSCHLO',
'LOTUSDEV',
'LOTUSEYE',
'LOVABLE',
'LOYALTEX',
'LPDC',
'LT',
'LTF',
'LTFOODS',
'LTIM',
'LTTS',
'LUMAXIND',
'LUMAXTECH',
'LUPIN',
'LUXIND',
'LXCHEM',
'LYKALABS',
'LYPSAGEMS',
'M&M',
'M&MFIN',
'MAANALU',
'MACPOWER',
'MADHAV',
'MADHUCON',
'MADRASFERT',
'MAGADSUGAR',
'MAGNUM',
'MAHABANK',
'MAHAPEXLTD',
'MAHASTEEL',
'MAHEPC',
'MAHESHWARI',
'MAHLIFE',
'MAHLOG',
'MAHSCOOTER',
'MAHSEAMLES',
'MAITHANALL',
'MALLCOM',
'MALUPAPER',
'MAMATA',
'MANAKALUCO',
'MANAKCOAT',
'MANAKSIA',
'MANAKSTEEL',
'MANALIPETC',
'MANAPPURAM',
'MANBA',
'MANCREDIT',
'MANGALAM',
'MANGCHEFER',
'MANGLMCEM',
'MANINDS',
'MANINFRA',
'MANKIND',
'MANOMAY',
'MANORAMA',
'MANORG',
'MANUGRAPH',
'MANYAVAR',
'MAPMYINDIA',
'MARALOVER',
'MARATHON',
'MARICO',
'MARINE',
'MARKSANS',
'MARUTI',
'MASFIN',
'MASKINVEST',
'MASTEK',
'MASTERTR',
'MATRIMONY',
'MAWANASUG',
'MAXESTATES',
'MAXHEALTH',
'MAXIND',
'MAYURUNIQ',
'MAZDA',
'MAZDOCK',
'MBAPL',
'MBEL',
'MBLINFRA',
'MCL',
'MCLEODRUSS',
'MCLOUD',
'MCX',
'MEDANTA',
'MEDIASSIST',
'MEDICAMEQ',
'MEDICO',
'MEDPLUS',
'MEGASOFT',
'MEGASTAR',
'MEIL',
'MENONBE',
'MEP',
'METROBRAND',
'METROPOLIS',
'MFML',
'MFSL',
'MGEL',
'MGL',
'MHLXMIRU',
'MHRIL',
'MICEL',
'MIDHANI',
'MINDACORP',
'MINDTECK',
'MIRCELECTR',
'MIRZAINT',
'MITCON',
'MITTAL',
'MKPL',
'MMFL',
'MMP',
'MMTC',
'MOBIKWIK',
'MODIRUBBER',
'MODISONLTD',
'MODTHREAD',
'MOHITIND',
'MOIL',
'MOKSH',
'MOL',
'MOLDTECH',
'MOLDTKPAC',
'MONARCH',
'MONTECARLO',
'MORARJEE',
'MOREPENLAB',
'MOSCHIP',
'MOTHERSON',
'MOTILALOFS',
'MOTISONS',
'MOTOGENFIN',
'MPHASIS',
'MPSLTD',
'MRF',
'MRPL',
'MSPL',
'MSTCLTD',
'MSUMI',
'MTARTECH',
'MTEDUCARE',
'MTNL',
'MUFIN',
'MUFTI',
'MUKANDLTD',
'MUKKA',
'MUKTAARTS',
'MUNJALAU',
'MUNJALSHOW',
'MURUDCERA',
'MUTHOOTCAP',
'MUTHOOTFIN',
'MUTHOOTMF',
'MVGJL',
'MWL',
'NACLIND',
'NAGAFERT',
'NAGREEKCAP',
'NAGREEKEXP',
'NAHARCAP',
'NAHARINDUS',
'NAHARPOLY',
'NAHARSPING',
'NAM-INDIA',
'NARMADA',
'NATCAPSUQ',
'NATCOPHARM',
'NATHBIOGEN',
'NATIONALUM',
'NAUKRI',
'NAVA',
'NAVINFLUOR',
'NAVKARCORP',
'NAVKARURB',
'NAVNETEDUL',
'NAZARA',
'NBCC',
'NBIFIN',
'NCC',
'NCLIND',
'NDGL',
'NDL',
'NDLVENTURE',
'NDRAUTO',
'NDTV',
'NDTV-RE',
'NECCLTD',
'NECLIFE',
'NELCAST',
'NELCO',
'NEOGEN',
'NESCO',
'NESTLEIND',
'NETWEB',
'NETWORK18',
'NEULANDLAB',
'NEWGEN',
'NEXTMEDIA',
'NFL',
'NGIL',
'NGLFINE',
'NH',
'NHPC',
'NIACL',
'NIBE',
'NIBL',
'NIITLTD',
'NIITMTS',
'NILAINFRA',
'NILASPACES',
'NILKAMAL',
'NINSYS',
'NIPPOBATRY',
'NIRAJ',
'NIRAJISPAT',
'NITCO',
'NITINSPIN',
'NITIRAJ',
'NIVABUPA',
'NKIND',
'NLCINDIA',
'NMDC',
'NOCIL',
'NOIDATOLL',
'NORBTEAEXP',
'NORTHARC',
'NOVAAGRI',
'NPST',
'NRAIL',
'NRBBEARING',
'NRL',
'NSIL',
'NSLNISP',
'NTPC',
'NTPCGREEN',
'NUCLEUS',
'NURECA',
'NUVAMA',
'NUVOCO',
'NYKAA',
'OAL',
'OBCL',
'OBEROIRLTY',
'OCCLLTD',
'ODIGMA',
'OFSS',
'OIL',
'OILCOUNTUB',
'OLAELEC',
'OLECTRA',
'OMAXAUTO',
'OMAXE',
'OMINFRAL',
'OMKARCHEM',
'ONELIFECAP',
'ONEPOINT',
'ONESOURCE',
'ONGC',
'ONMOBILE',
'ONWARDTEC',
'OPTIEMUS',
'ORBTEXP',
'ORCHASP',
'ORCHPHARMA',
'ORICONENT',
'ORIENTALTL',
'ORIENTBELL',
'ORIENTCEM',
'ORIENTCER',
'ORIENTELEC',
'ORIENTHOT',
'ORIENTLTD',
'ORIENTPPR',
'ORIENTTECH',
'ORISSAMINE',
'ORTEL',
'ORTINGLOBE',
'OSIAHYPER',
'OSWALAGRO',
'OSWALGREEN',
'OSWALPUMPS',
'OSWALSEEDS',
'PAGEIND',
'PAISALO',
'PAKKA',
'PALASHSECU',
'PALREDTEC',
'PANACEABIO',
'PANACHE',
'PANAMAPET',
'PANSARI',
'PAR',
'PARACABLES',
'PARADEEP',
'PARAGMILK',
'PARAS',
'PARASPETRO',
'PARKHOTELS',
'PARSVNATH',
'PASHUPATI',
'PASUPTAC',
'PATANJALI',
'PATELENG',
'PATELRMART',
'PATINTLOG',
'PAVNAIND',
'PAYTM',
'PCBL',
'PCJEWELLER',
'PDMJEPAPER',
'PDSL',
'PEARLPOLY',
'PENIND',
'PENINLAND',
'PERSISTENT',
'PETRONET',
'PFC',
'PFIZER',
'PFOCUS',
'PFS',
'PGEL',
'PGHH',
'PGHL',
'PGIL',
'PHOENIXLTD',
'PICCADIL',
'PIDILITIND',
'PIGL',
'PIIND',
'PILANIINVS',
'PILITA',
'PIONEEREMB',
'PITTIENG',
'PIXTRANS',
'PKTEA',
'PLASTIBLEN',
'PLATIND',
'PLAZACABLE',
'PNB',
'PNBGILTS',
'PNBHOUSING',
'PNC',
'PNCINFRA',
'PNGJL',
'POCL',
'PODDARMENT',
'POKARNA',
'POLICYBZR',
'POLYCAB',
'POLYMED',
'POLYPLEX',
'PONNIERODE',
'POONAWALLA',
'POWERGRID',
'POWERINDIA',
'POWERMECH',
'PPAP',
'PPL',
'PPLPHARMA',
'PRABHA',
'PRAENG',
'PRAJIND',
'PRAKASH',
'PRAKASHSTL',
'PRAXIS',
'PRECAM',
'PRECOT',
'PRECWIRE',
'PREMEXPLN',
'PREMIER',
'PREMIERENE',
'PREMIERPOL',
'PRESTIGE',
'PRICOLLTD',
'PRIMESECU',
'PRIMO',
'PRINCEPIPE',
'PRITI',
'PRITIKAUTO',
'PRIVISCL',
'PROSTARM',
'PROTEAN',
'PROZONER',
'PRSMJOHNSN',
'PRUDENT',
'PRUDMOULI',
'PSB',
'PSPPROJECT',
'PTC',
'PTCIL',
'PTL',
'PUNJABCHEM',
'PURVA',
'PVP',
'PVRINOX',
'PVSL',
'PYRAMID',
'QPOWER',
'QUADFUTURE',
'QUESS',
'QUICKHEAL',
'RACE',
'RACLGEAR',
'RADAAN',
'RADHIKAJWE',
'RADIANTCMS',
'RADICO',
'RADIOCITY',
'RAILTEL',
'RAIN',
'RAINBOW',
'RAJESHEXPO',
'RAJMET',
'RAJOOENG',
'RAJRATAN',
'RAJRILTD',
'RAJSREESUG',
'RAJTV',
'RALLIS',
'RAMANEWS',
'RAMAPHO',
'RAMASTEEL',
'RAMCOCEM',
'RAMCOIND',
'RAMCOSYS',
'RAMKY',
'RAMRAT',
'RANASUG',
'RANEHOLDIN',
'RATEGAIN',
'RATNAMANI',
'RATNAVEER',
'RAYMOND',
'RAYMONDLSL',
'RAYMONDREL',
'RBA',
'RBLBANK',
'RBZJEWEL',
'RCF',
'RCOM',
'RECLTD',
'REDINGTON',
'REDTAPE',
'REFEX',
'REGAAL',
'REGENCERAM',
'RELAXO',
'RELCHEMQ',
'RELIABLE',
'RELIANCE',
'RELIGARE',
'RELINFRA',
'RELTD',
'REMSONSIND',
'RENUKA',
'REPCOHOME',
'REPL',
'REPRO',
'RESPONIND',
'RETAIL',
'RGL',
'RHETAN',
'RHFL',
'RHIM',
'RHL',
'RICOAUTO',
'RIIL',
'RISHABH',
'RITCO',
'RITES',
'RKDL',
'RKEC',
'RKFORGE',
'RKSWAMY',
'RMDRIP',
'RML',
'RNBDENIMS',
'ROHLTD',
'ROLEXRINGS',
'ROLLT',
'ROLTA',
'ROML',
'ROSSARI',
'ROSSELLIND',
'ROSSTECH',
'ROTO',
'ROUTE',
'RPEL',
'RPGLIFE',
'RPOWER',
'RPPINFRA',
'RPPL',
'RPSGVENT',
'RPTECH',
'RRKABEL',
'RSSOFTWARE',
'RSWM',
'RSYSTEMS',
'RTNINDIA',
'RTNPOWER',
'RUBFILA',
'RUBYMILLS',
'RUCHINFRA',
'RUCHIRA',
'RUPA',
'RUSHIL',
'RUSTOMJEE',
'RVHL',
'RVNL',
'RVTH',
'S&SPOWER',
'SAATVIKGL',
'SABEVENTS',
'SABTNL',
'SADBHAV',
'SADBHIN',
'SADHNANIQ',
'SAFARI',
'SAGARDEEP',
'SAGCEM',
'SAGILITY',
'SAHYADRI',
'SAIL',
'SAILIFE',
'SAKAR',
'SAKHTISUG',
'SAKSOFT',
'SAKUMA',
'SALASAR',
'SALONA',
'SALSTEEL',
'SALZERELEC',
'SAMBHAAV',
'SAMBHV',
'SAMHI',
'SAMMAANCAP',
'SAMPANN',
'SANATHAN',
'SANDESH',
'SANDHAR',
'SANDUMA',
'SANGAMIND',
'SANGHIIND',
'SANGHVIMOV',
'SANGINITA',
'SANOFI',
'SANOFICONR',
'SANSERA',
'SANSTAR',
'SANWARIA',
'SAPPHIRE',
'SARDAEN',
'SAREGAMA',
'SARLAPOLY',
'SARVESHWAR',
'SASKEN',
'SASTASUNDR',
'SATIA',
'SATIN',
'SAURASHCEM',
'SBC',
'SBCL',
'SBFC',
'SBGLP',
'SBICARD',
'SBILIFE',
'SBIN',
'SCHAEFFLER',
'SCHAND',
'SCHNEIDER',
'SCI',
'SCILAL',
'SCODATUBES',
'SCPL',
'SDBL',
'SEAMECLTD',
'SECMARK',
'SECURKLOUD',
'SEJALLTD',
'SELMC',
'SEMAC',
'SENCO',
'SENORES',
'SEPC',
'SEQUENT',
'SERVOTECH',
'SESHAPAPER',
'SETCO',
'SETUINFRA',
'SEYAIND',
'SFL',
'SGFIN',
'SGIL',
'SGL',
'SGLTL',
'SGMART',
'SHAH',
'SHAHALLOYS',
'SHAILY',
'SHAKTIPUMP',
'SHALBY',
'SHALPAINTS',
'SHANKARA',
'SHANTI',
'SHANTIGEAR',
'SHANTIGOLD',
'SHARDACROP',
'SHARDAMOTR',
'SHAREINDIA',
'SHEKHAWATI',
'SHEMAROO',
'SHILPAMED',
'SHIVALIK',
'SHIVAMAUTO',
'SHIVAMILLS',
'SHIVATEX',
'SHK',
'SHOPERSTOP',
'SHRADHA',
'SHREDIGCEM',
'SHREECEM',
'SHREEJISPG',
'SHREEPUSHK',
'SHREERAMA',
'SHRENIK',
'SHREYANIND',
'SHRINGARMS',
'SHRIPISTON',
'SHRIRAMFIN',
'SHRIRAMPPS',
'SHYAMCENT',
'SHYAMMETL',
'SHYAMTEL',
'SIEMENS',
'SIGACHI',
'SIGIND',
'SIGMA',
'SIGNATURE',
'SIGNPOST',
'SIKKO',
'SIL',
'SILGO',
'SILINV',
'SILLYMONKS',
'SILVERTUC',
'SIMBHALS',
'SIMPLEXINF',
'SINCLAIR',
'SINDHUTRAD',
'SINTERCOM',
'SIRCA',
'SIS',
'SITINET',
'SIYSIL',
'SJS',
'SJVN',
'SKFINDIA',
'SKIPPER',
'SKMEGGPROD',
'SKYGOLD',
'SMARTLINK',
'SMARTWORKS',
'SMCGLOBAL',
'SMLISUZU',
'SMLT',
'SMSLIFE',
'SMSPHARMA',
'SNOWMAN',
'SOBHA',
'SOFTTECH',
'SOLARA',
'SOLARINDS',
'SOLARWORLD',
'SOMANYCERA',
'SOMATEX',
'SOMICONVEY',
'SONACOMS',
'SONAMLTD',
'SONATSOFTW',
'SOTL',
'SOUTHBANK',
'SOUTHWEST',
'SPAL',
'SPANDANA',
'SPARC',
'SPCENET',
'SPECIALITY',
'SPECTRUM',
'SPENCERS',
'SPIC',
'SPLIL',
'SPLPETRO',
'SPMLINFRA',
'SPORTKING',
'SRD',
'SREEL',
'SRF',
'SRGHFL',
'SRHHYPOLTD',
'SRM',
'SRPL',
'SSDL',
'SSWL',
'STALLION',
'STANLEY',
'STAR',
'STARCEMENT',
'STARHEALTH',
'STARPAPER',
'STARTECK',
'STCINDIA',
'STEELCAS',
'STEELCITY',
'STEELXIND',
'STEL',
'STERTOOLS',
'STLNETWORK',
'STLTECH',
'STOVEKRAFT',
'STYL',
'STYLAMIND',
'STYLEBAAZA',
'STYRENIX',
'SUBEXLTD',
'SUBROS',
'SUDARSCHEM',
'SUKHJITS',
'SULA',
'SUMEETINDS',
'SUMICHEM',
'SUMIT',
'SUMMITSEC',
'SUNCLAY',
'SUNDARAM',
'SUNDARMFIN',
'SUNDARMHLD',
'SUNDRMBRAK',
'SUNDRMFAST',
'SUNDROP',
'SUNFLAG',
'SUNPHARMA',
'SUNTECK',
'SUNTV',
'SUPERHOUSE',
'SUPERSPIN',
'SUPRAJIT',
'SUPREME',
'SUPREMEIND',
'SUPREMEINF',
'SUPRIYA',
'SURAJEST',
'SURAJLTD',
'SURAKSHA',
'SURANASOL',
'SURANAT&P',
'SURYALAXMI',
'SURYAROSNI',
'SURYODAY',
'SUTLEJTEX',
'SUVEN',
'SUVIDHAA',
'SUYOG',
'SUZLON',
'SVLL',
'SVPGLOB',
'SWANCORP',
'SWARAJENG',
'SWELECTES',
'SWIGGY',
'SWSOLAR',
'SYMPHONY',
'SYNCOMF',
'SYNGENE',
'SYRMA',
'TAINWALCHM',
'TAJGVK',
'TAKE',
'TALBROAUTO',
'TANLA',
'TARACHAND',
'TARAPUR',
'TARC',
'TARIL',
'TARMAT',
'TARSONS',
'TASTYBITE',
'TATACHEM',
'TATACOMM',
'TATACONSUM',
'TATAELXSI',
'TATAINVEST',
'TATAMOTORS',
'TATAPOWER',
'TATASTEEL',
'TATATECH',
'TATVA',
'TBOTEK',
'TBZ',
'TCI',
'TCIEXP',
'TCIFINANCE',
'TCPLPACK',
'TCS',
'TDPOWERSYS',
'TEAMGTY',
'TEAMLEASE',
'TECHM',
'TECHNOE',
'TECILCHEM',
'TEGA',
'TEJASNET',
'TEMBO',
'TERASOFT',
'TEXINFRA',
'TEXMOPIPES',
'TEXRAIL',
'TFCILTD',
'TFL',
'TGBHOTELS',
'THANGAMAYL',
'THEINVEST',
'THEJO',
'THELEELA',
'THEMISMED',
'THERMAX',
'THOMASCOOK',
'THOMASCOTT',
'THYROCARE',
'TI',
'TICL',
'TIGERLOGS',
'TIIL',
'TIINDIA',
'TIJARIA',
'TIL',
'TIMETECHNO',
'TIMKEN',
'TINNARUBR',
'TIPSFILMS',
'TIPSMUSIC',
'TIRUMALCHM',
'TIRUPATIFL',
'TITAGARH',
'TITAN',
'TMB',
'TNPETRO',
'TNPL',
'TNTELE',
'TOKYOPLAST',
'TOLINS',
'TORNTPHARM',
'TORNTPOWER',
'TOTAL',
'TOUCHWOOD',
'TPHQ',
'TPLPLASTEH',
'TRACXN',
'TRANSRAILL',
'TRANSWORLD',
'TRAVELFOOD',
'TREEHOUSE',
'TREJHARA',
'TREL',
'TRENT',
'TRF',
'TRIDENT',
'TRIGYN',
'TRITURBINE',
'TRIVENI',
'TRU',
'TTKHLTCARE',
'TTKPRESTIG',
'TTL',
'TTML',
'TVSELECT',
'TVSHLTD',
'TVSMOTOR',
'TVSSCS',
'TVSSRICHAK',
'TVTODAY',
'TVVISION',
'UBL',
'UCAL',
'UCOBANK',
'UDS',
'UEL',
'UFLEX',
'UFO',
'UGARSUGAR',
'UGROCAP',
'UJJIVANSFB',
'ULTRACEMCO',
'UMAEXPORTS',
'UMESLTD',
'UMIYA-MRO',
'UNICHEMLAB',
'UNIDT',
'UNIECOM',
'UNIENTER',
'UNIINFO',
'UNIMECH',
'UNIONBANK',
'UNIPARTS',
'UNITDSPR',
'UNITECH',
'UNITEDPOLY',
'UNITEDTEA',
'UNIVASTU',
'UNIVCABLES',
'UNIVPHOTO',
'UNOMINDA',
'UPL',
'URAVIDEF',
'URBANCO',
'URJA',
'USHAMART',
'USK',
'UTIAMC',
'UTKARSHBNK',
'UTTAMSUGAR',
'UYFINCORP',
'V2RETAIL',
'VADILALIND',
'VAIBHAVGBL',
'VAISHALI',
'VAKRANGEE',
'VALIANTLAB',
'VALIANTORG',
'VARDHACRLC',
'VARDMNPOLY',
'VARROC',
'VASCONEQ',
'VASWANI',
'VBL',
'VCL',
'VEDL',
'VEEDOL',
'VENKEYS',
'VENTIVE',
'VENUSPIPES',
'VENUSREM',
'VERANDA',
'VERTOZ',
'VESUVIUS',
'VETO',
'VGUARD',
'VHL',
'VHLTD',
'VIDHIING',
'VIJAYA',
'VIJIFIN',
'VIKASECO',
'VIKASLIFE',
'VIKRAMSOLR',
'VIKRAN',
'VIMTALABS',
'VINATIORGA',
'VINCOFE',
'VINDHYATEL',
'VINEETLAB',
'VINNY',
'VINYLINDIA',
'VIPCLOTHNG',
'VIPIND',
'VIPULLTD',
'VIRINCHI',
'VISAKAIND',
'VISASTEEL',
'VISHNU',
'VISHWARAJ',
'VIVIDHA',
'VLEGOV',
'VLSFINANCE',
'VMART',
'VMM',
'VMSTMT',
'VOLTAMP',
'VOLTAS',
'VPRPL',
'VRAJ',
'VRLLOG',
'VSSL',
'VSTIND',
'VSTL',
'VSTTILLERS',
'VTL',
'WAAREEENER',
'WAAREEINDO',
'WAAREERTL',
'WABAG',
'WALCHANNAG',
'WANBURY',
'WCIL',
'WEALTH',
'WEBELSOLAR',
'WEIZMANIND',
'WEL',
'WELCORP',
'WELENT',
'WELINV',
'WELSPUNLIV',
'WENDT',
'WESTLIFE',
'WEWIN',
'WHEELS',
'WHIRLPOOL',
'WILLAMAGOR',
'WINDLAS',
'WINDMACHIN',
'WINSOME',
'WIPL',
'WIPRO',
'WOCKPHARMA',
'WONDERLA',
'WORTH',
'WSI',
'WSTCSTPAPR',
'XCHANGING',
'XELPMOC',
'XPROINDIA',
'XTGLOBAL',
'YASHO',
'YATHARTH',
'YATRA',
'YESBANK',
'YUKEN',
'ZAGGLE',
'ZEEL',
'ZEELEARN',
'ZEEMEDIA',
'ZENITHEXPO',
'ZENITHSTL',
'ZENSARTECH',
'ZENTEC',
'ZFCVINDIA',
'ZIMLAB',
'ZODIAC',
'ZODIACLOTH',
'ZOTA',
'ZUARI',
'ZUARIIND',
'ZYDUSLIFE',
'ZYDUSWELL'
]


def fetch_stock_data(symbol, start_date, end_date):
    try:
        # Fetch data from Yahoo Finance
        stock = yf.Ticker(f"{symbol}.NS")
        data = stock.history(start=start_date, end=end_date)

        if not data.empty:
            # Reset index to make date a column
            data = data.reset_index()
            # Remove timezone info
            data['Date'] = data['Date'].dt.tz_localize(None)
            # Add symbol column
            data['Symbol'] = symbol

            # Get market cap
            info = stock.info
            market_cap = info.get('marketCap', 0)
            data['Market_Cap'] = market_cap

            # Select and rename relevant columns
            return data[['Date', 'Symbol', 'Open', 'High', 'Low', 'Close', 'Volume', 'Market_Cap']]

        return None
    except Exception as e:
        print(f"Error fetching data for {symbol}: {str(e)}")
        return None


def main():
    # Set date range for last 30 days
    end_date = datetime.now()
    start_date = end_date - timedelta(days=3)

    print(f"Fetching data for {len(NIFTY_STOCKS)} stocks...")
    print(f"Date range: {start_date.date()} to {end_date.date()}")

    # Store all data
    all_data = []
    successful_fetches = 0
    failed_fetches = 0

    # Process each symbol
    for i, symbol in enumerate(NIFTY_STOCKS, 1):
        print(f"Processing {symbol} ({i}/{len(NIFTY_STOCKS)})")

        data = fetch_stock_data(symbol, start_date, end_date)
        if data is not None:
            all_data.append(data)
            successful_fetches += 1
        else:
            failed_fetches += 1

        # Add delay to avoid rate limiting
        time.sleep(1)

    if all_data:
        # Combine all data
        final_df = pd.concat(all_data, ignore_index=True)

        # Convert market cap to crores
        final_df['Market_Cap_Cr'] = final_df['Market_Cap'] / 10000000

        # Sort by market cap and date
        final_df = final_df.sort_values(['Market_Cap', 'Date'], ascending=[False, True])

        # Create summary DataFrame with latest data and market cap
        latest_data = final_df.sort_values('Date').groupby('Symbol').last()
        summary_df = latest_data.sort_values('Market_Cap', ascending=False)
        summary_df = summary_df.reset_index()

        # Calculate additional metrics
        summary_df['30_Day_High'] = final_df.groupby('Symbol')['High'].max().values
        summary_df['30_Day_Low'] = final_df.groupby('Symbol')['Low'].min().values
        summary_df['Avg_Volume'] = final_df.groupby('Symbol')['Volume'].mean().values

        # Save detailed data
        output_file = "../nifty_stocks_3days_detailed.xlsx"
        final_df.to_excel(output_file, index=False)

        # Save summary data
        summary_file = "../nifty_stocks_summary.xlsx"
        summary_df.to_excel(summary_file, index=False)

        print("\nProcessing complete!")
        print(f"Successful fetches: {successful_fetches}")
        print(f"Failed fetches: {failed_fetches}")
        print(f"\nDetailed data saved to: {output_file}")
        print(f"Summary data saved to: {summary_file}")

        print("\nTop 10 companies by market cap:")
        print(summary_df[['Symbol', 'Market_Cap_Cr', 'Close', '30_Day_High', '30_Day_Low']].head(10))

        # Calculate some statistics
        print("\nMarket Statistics:")
        print(f"Total market cap: ₹{summary_df['Market_Cap_Cr'].sum():,.2f} Cr")
        print(f"Average market cap: ₹{summary_df['Market_Cap_Cr'].mean():,.2f} Cr")
        print(f"Average daily volume: {summary_df['Avg_Volume'].mean():,.0f}")

    else:
        print("No data was collected")


if __name__ == "__main__":
    main()
